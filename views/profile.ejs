<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head.ejs') %>
  <title>Profile - TodoPro</title>
  <style>
    :root {
      /* Google Material Design 3 Color Palette - Lighter theme */
      --primary: #4285f4;
      --primary-container: #e8f2ff;
      --on-primary: #ffffff;
      --secondary: #34a853;
      --secondary-container: #e8f5e8;
      --on-secondary: #ffffff;
      --tertiary: #ea4335;
      --tertiary-container: #fce8e6;
      --on-tertiary: #ffffff;
      --error: #ea4335;
      --error-container: #fce8e6;
      --on-error: #ffffff;
      --background: #fafafa;
      --on-background: #1a1c1e;
      --surface: #ffffff;
      --on-surface: #1a1c1e;
      --surface-variant: #f5f5f5;
      --on-surface-variant: #5f6368;
      --outline: #dadce0;

      /* Text Colors */
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --text-disabled: #9aa0a6;

      /* Layout */
      --max-width: 1200px;
      --border-radius: 8px;
      --border-radius-lg: 12px;
      --border-radius-xl: 16px;
      --shadow-1: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.12);
      --shadow-2: 0 2px 6px rgba(0, 0, 0, 0.10), 0 2px 4px rgba(0, 0, 0, 0.12);
      --shadow-3: 0 4px 12px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.12);
      --shadow-4: 0 6px 20px rgba(0, 0, 0, 0.15), 0 6px 12px rgba(0, 0, 0, 0.12);
      --shadow-5: 0 8px 32px rgba(0, 0, 0, 0.18), 0 8px 16px rgba(0, 0, 0, 0.12);

      /* Spacing */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 24px;
      --space-6: 32px;

      /* Transitions */
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--background);
      color: var(--on-background);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Header Section */
    .profile-header {
      background: var(--primary);
      position: relative;
      overflow: hidden;
      padding: var(--space-5) 0 var(--space-4);
      margin-bottom: var(--space-4);
      color: var(--on-primary);
    }

    @media (max-width: 768px) {
      .profile-header {
        padding: var(--space-4) 0 var(--space-3);
        margin-bottom: var(--space-3);
      }
    }

    .profile-header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-variant);
    }

    .profile-avatar-container {
      position: relative;
      display: inline-block;
      margin-bottom: var(--space-4);
    }

    .profile-avatar {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      border: 4px solid rgba(255, 255, 255, 0.9);
      background: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: white;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-3);
      transition: var(--transition);
      cursor: pointer;
    }

    .profile-avatar:hover {
      box-shadow: var(--shadow-4);
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-edit-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: var(--transition);
      border-radius: 50%;
      cursor: pointer;
    }

    .profile-avatar-container:hover .avatar-edit-overlay {
      opacity: 1;
    }

    .profile-info h1 {
      font-size: 2.125rem;
      font-weight: 400;
      color: var(--on-primary);
      margin-bottom: var(--space-1);
      text-align: center;
    }

    @media (max-width: 768px) {
      .profile-info h1 {
        font-size: 1.75rem;
      }
    }

    .profile-info .username {
      font-size: 1rem;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 400;
      margin-bottom: var(--space-1);
      text-align: center;
    }

    @media (max-width: 768px) {
      .profile-info .username {
        font-size: 0.875rem;
      }
    }

    .profile-info .member-since {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 400;
      text-align: center;
    }

    @media (max-width: 768px) {
      .profile-info .member-since {
        font-size: 0.75rem;
      }
    }

    /* Main Content */
    .main-content {
      max-width: var(--max-width);
      margin: -var(--space-4) auto 0;
      padding: 0 var(--space-3);
      position: relative;
      z-index: 10;
    }

    /* Stats Section */
    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-5);
    }

    @media (max-width: 768px) {
      .stats-section {
        grid-template-columns: 1fr;
        gap: var(--space-3);
      }
    }

    .stat-card {
      background: var(--surface);
      border-radius: var(--border-radius-lg);
      padding: var(--space-4);
      box-shadow: var(--shadow-1);
      border: 1px solid rgba(0, 0, 0, 0.12);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary);
    }

    .stat-card:hover {
      box-shadow: var(--shadow-2);
    }

    .stat-icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: var(--space-2);
      background: var(--primary);
      color: var(--on-primary);
    }

    .stat-number {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--space-1);
      line-height: 1.2;
    }

    .stat-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Content Cards */
    .content-card {
      background: var(--surface);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-1);
      border: 1px solid rgba(0, 0, 0, 0.12);
      margin-bottom: var(--space-4);
      overflow: hidden;
      transition: var(--transition);
    }

    @media (max-width: 768px) {
      .content-card {
        margin-bottom: var(--space-3);
      }
    }

    .content-card:hover {
      box-shadow: var(--shadow-2);
    }

    .card-header-custom {
      padding: var(--space-4) var(--space-4) var(--space-3);
      border-bottom: 1px solid rgba(0, 0, 0, 0.12);
      background: var(--surface);
    }

    @media (max-width: 768px) {
      .card-header-custom {
        padding: var(--space-3) var(--space-3) var(--space-2);
      }
    }

    .card-title {
      font-size: 1.125rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    @media (max-width: 768px) {
      .card-title {
        font-size: 1rem;
        gap: var(--space-1);
      }
    }

    .card-title i {
      color: var(--primary);
      font-size: 1.125rem;
    }

    @media (max-width: 768px) {
      .card-title i {
        font-size: 1rem;
      }
    }

    .card-body-custom {
      padding: var(--space-4);
    }

    /* Achievements */
    .achievements-grid {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2);
      justify-content: center;
    }

    .achievement-badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-1);
      padding: var(--space-2) var(--space-3);
      background: #fff3e0;
      color: #e65100;
      border-radius: 16px;
      font-weight: 500;
      font-size: 0.875rem;
      border: 1px solid #ffb74d;
      box-shadow: var(--shadow-1);
      transition: var(--transition);
    }

    .achievement-badge:hover {
      box-shadow: var(--shadow-2);
    }

    .achievement-badge i {
      font-size: 1rem;
    }

    /* Activity Items */
    .activity-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: var(--space-2);
      padding: var(--space-3);
      background: rgba(0, 0, 0, 0.04);
      border-radius: var(--border-radius);
      border: 1px solid rgba(0, 0, 0, 0.12);
      transition: var(--transition);
    }

    .activity-item:hover {
      background: var(--surface);
      box-shadow: var(--shadow-1);
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--on-primary);
      flex-shrink: 0;
    }

    .activity-content h4 {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 var(--space-1) 0;
    }

    .activity-content p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0 0 var(--space-1) 0;
    }

    .activity-meta {
      font-size: 0.75rem;
      color: var(--text-secondary);
      font-weight: 400;
    }

    /* Settings Grid */
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--space-3);
    }

    @media (max-width: 768px) {
      .settings-grid {
        grid-template-columns: 1fr;
        gap: var(--space-2);
      }
    }

    .setting-card {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-4);
      background: var(--surface);
      border-radius: var(--border-radius-lg);
      border: 1px solid rgba(0, 0, 0, 0.12);
      transition: var(--transition);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .setting-card:hover {
      box-shadow: var(--shadow-2);
    }

    .setting-icon {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: var(--on-primary);
      flex-shrink: 0;
      transition: var(--transition);
    }

    .setting-content h5 {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0 0 var(--space-1) 0;
    }

    .setting-content p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: var(--space-2);
      justify-content: center;
      margin-top: var(--space-5);
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .action-buttons {
        flex-direction: column;
        align-items: center;
        gap: var(--space-3);
      }
    }

    .btn-primary-custom {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      background: var(--primary);
      color: var(--on-primary);
      border: none;
      border-radius: var(--border-radius);
      font-weight: 500;
      font-size: 0.875rem;
      text-decoration: none;
      transition: var(--transition);
      box-shadow: var(--shadow-2);
      min-height: 36px;
    }

    .btn-primary-custom:hover {
      background: var(--primary-variant);
      box-shadow: var(--shadow-3);
    }

    .btn-secondary-custom {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      background: var(--surface);
      color: var(--primary);
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      font-weight: 500;
      font-size: 0.875rem;
      text-decoration: none;
      transition: var(--transition);
      box-shadow: var(--shadow-1);
      min-height: 36px;
    }

    .btn-secondary-custom:hover {
      background: rgba(25, 118, 210, 0.04);
      box-shadow: var(--shadow-2);
    }

    /* Modals */
    .modal-content {
      border-radius: var(--border-radius-xl);
      border: none;
      box-shadow: var(--shadow-5);
      background: var(--surface);
      overflow: hidden;
    }

    .modal-header {
      padding: var(--space-5) var(--space-4) var(--space-4);
      border-bottom: 1px solid rgba(0, 0, 0, 0.12);
      background: var(--surface);
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--text-primary);
      margin: 0;
    }

    .modal-body {
      padding: var(--space-4);
    }

    .modal-footer {
      padding: var(--space-4);
      border-top: 1px solid rgba(0, 0, 0, 0.12);
      background: rgba(0, 0, 0, 0.04);
    }

    /* Forms */
    .form-label {
      display: block;
    }
  </style>
</head>
  <body>
  <%- include('./partials/navbar.ejs') %>

  <%- include('./partials/alerts.ejs') %>

  <!-- Profile Header -->
  <header class="profile-header">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8 text-center">
          <div class="profile-avatar-container">
            <a href="#" class="text-decoration-none d-block" data-bs-toggle="modal" data-bs-target="#uploadPhotoModal">
              <div class="profile-avatar">
                <% if (user.profilePicture) { %>
                  <img src="<%= user.profilePicture %>" alt="Profile Picture">
                <% } else { %>
                  <i class="fas fa-user-circle"></i>
                <% } %>
                <div class="avatar-edit-overlay">
                  <i class="fas fa-camera text-white"></i>
                </div>
              </div>
            </a>
          </div>

          <h1 class="h2 fw-normal mb-2">
            <%= user.name %>
            <a href="#" data-bs-toggle="modal" data-bs-target="#editProfileModal" class="ms-2 text-white-50 text-decoration-none">
              <i class="fas fa-edit"></i>
            </a>
          </h1>
          <p class="lead mb-0">@<%= user.username %></p>
          <p class="mt-2 opacity-75">Member since <%= new Date(user.createdAt || Date.now()).toLocaleDateString('en-US', { year: 'numeric', month: 'long' }) %></p>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-10">

          <!-- Statistics Section -->
          <div class="card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4 text-center">
                <i class="fas fa-chart-line me-2"></i>Performance Overview
              </h3>
              <div class="stats-section">
                <div class="stat-card">
                  <div class="stat-number"><%= taskCount || 0 %></div>
                  <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number"><%= completedTasks || 0 %></div>
                  <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number"><%= pendingTasks || 0 %></div>
                  <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number"><%= overdueTasks || 0 %></div>
                  <div class="stat-label">Overdue</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Achievements Section -->
          <div class="card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="fas fa-trophy me-2"></i>Achievements
              </h3>
              <div class="text-center">
                <% if ((completedTasks || 0) >= 10) { %>
                  <span class="achievement-badge">
                    <i class="fas fa-star me-1"></i>Task Master (10+ completed)
                  </span>
                <% } %>
                <% if ((taskCount || 0) >= 50) { %>
                  <span class="achievement-badge">
                    <i class="fas fa-crown me-1"></i>Productivity Champion (50+ tasks)
                  </span>
                <% } %>
                <% if ((projectCount || 0) >= 5) { %>
                  <span class="achievement-badge">
                    <i class="fas fa-rocket me-1"></i>Project Manager (5+ projects)
                  </span>
                <% } %>
                <% if ((completedTasks || 0) < 10 && (taskCount || 0) < 50 && (projectCount || 0) < 5) { %>
                  <div class="text-muted">
                    <i class="fas fa-medal me-2"></i>Complete more tasks to unlock achievements!
                  </div>
                <% } %>
              </div>
            </div>
          </div>

          <!-- Recent Activity Section -->
          <div class="card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="fas fa-history me-2"></i>Recent Activity
              </h3>
              <div class="activity-list">
                <% if (recentActivities && recentActivities.length > 0) { %>
                  <% recentActivities.forEach(activity => { %>
                    <div class="activity-item">
                      <div class="activity-icon">
                        <i class="fas fa-tasks"></i>
                      </div>
                      <div class="activity-content">
                        <h4><%= activity.title %></h4>
                        <p><%= activity.description %></p>
                        <small class="activity-meta">
                          <i class="fas fa-clock me-1"></i><%= new Date(activity.createdAt).toLocaleDateString() %>
                        </small>
                      </div>
                      <span class="badge bg-primary"><%= activity.type %></span>
                    </div>
                  <% }) %>
                <% } else { %>
                  <div class="text-center text-muted py-4">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <p>No recent activity to show</p>
                  </div>
                <% } %>
              </div>
            </div>
          </div>

          <!-- Settings Section -->
          <div class="card">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="fas fa-cog me-2"></i>Account Settings
              </h3>
              <div class="settings-grid">
                <div class="setting-card" data-bs-toggle="modal" data-bs-target="#editProfileModal">
                  <div class="setting-icon">
                    <i class="fas fa-user-edit"></i>
                  </div>
                  <div class="setting-content">
                    <h5>Edit Profile</h5>
                    <p class="text-muted mb-0">Update your personal information and preferences</p>
                  </div>
                </div>

                <div class="setting-card" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
                  <div class="setting-icon">
                    <i class="fas fa-lock"></i>
                  </div>
                  <div class="setting-content">
                    <h5>Change Password</h5>
                    <p class="text-muted mb-0">Update your account password for security</p>
                  </div>
                </div>

                <div class="setting-card" data-bs-toggle="modal" data-bs-target="#uploadPhotoModal">
                  <div class="setting-icon">
                    <i class="fas fa-camera"></i>
                  </div>
                  <div class="setting-content">
                    <h5>Profile Picture</h5>
                    <p class="text-muted mb-0">Upload or change your profile photo</p>
                  </div>
                </div>

                <div class="setting-card" data-bs-toggle="modal" data-bs-target="#notificationsModal">
                  <div class="setting-icon">
                    <i class="fas fa-bell"></i>
                  </div>
                  <div class="setting-content">
                    <h5>Notifications</h5>
                    <p class="text-muted mb-0">Manage your notification preferences</p>
                  </div>
                </div>
              </div>

              <div class="text-center mt-4">
                <a href="/dashboard" class="btn btn-primary-custom me-3">
                  <i class="fas fa-tachometer-alt me-2"></i>Go to Dashboard
                </a>
                <a href="/connect" class="btn btn-secondary-custom">
                  <i class="fas fa-users me-2"></i>Connect with Others
                </a>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </main>
  
  <div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-labelledby="uploadPhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadPhotoModalLabel">Upload a new profile photo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/profile/upload-photo" method="POST" enctype="multipart/form-data">
          <div class="modal-body">
            <div class="mb-3">
              <label for="profilePicture" class="form-label">Select a file:</label>
              <input class="form-control" type="file" id="profilePicture" name="profilePicture" accept="image/*" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-modal-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-modal-primary">Upload</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Edit Profile Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/profile/update" method="POST">
          <div class="modal-body">
            <div class="mb-3">
              <label for="name" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="name" name="name" value="<%= user.name %>" required>
            </div>
            <div class="mb-3">
              <label for="username" class="form-label">Username</label>
              <input type="text" class="form-control" id="username" name="username" value="<%= user.username %>" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/profile/change-password" method="POST">
          <div class="modal-body">
            <div class="mb-3">
              <label for="oldPassword" class="form-label">Old Password</label>
              <input type="password" class="form-control" id="oldPassword" name="oldPassword" required>
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password</label>
              <input type="password" class="form-control" id="newPassword" name="newPassword" required>
            </div>
            <div class="mb-3">
              <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
              <input type="password" class="form-control" id="confirmNewPassword" name="confirmNewPassword" required>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Change Password</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="notificationsModal" tabindex="-1" aria-labelledby="notificationsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="notificationsModalLabel">Notification Preferences</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/profile/update-notifications" method="POST">
          <div class="modal-body">
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="emailNotifications" name="emailNotifications" checked>
                <label class="form-check-label" for="emailNotifications">
                  Email Notifications
                </label>
              </div>
              <small class="text-muted">Receive email updates about your tasks and activities</small>
            </div>
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="taskReminders" name="taskReminders" checked>
                <label class="form-check-label" for="taskReminders">
                  Task Reminders
                </label>
              </div>
              <small class="text-muted">Get reminded about upcoming deadlines and overdue tasks</small>
            </div>
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="weeklyReports" name="weeklyReports" checked>
                <label class="form-check-label" for="weeklyReports">
                  Weekly Reports
                </label>
              </div>
              <small class="text-muted">Receive weekly summaries of your productivity</small>
            </div>
            <div class="mb-3">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="collaborationNotifications" name="collaborationNotifications" checked>
                <label class="form-check-label" for="collaborationNotifications">
                  Collaboration Updates
                </label>
              </div>
              <small class="text-muted">Notifications about shared tasks and room activities</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save Preferences</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <%- include('./partials/footer.ejs') %>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Password confirmation validation
    document.addEventListener('DOMContentLoaded', function() {
      const changePasswordForm = document.querySelector('#changePasswordModal form');
      const newPasswordInput = document.getElementById('newPassword');
      const confirmPasswordInput = document.getElementById('confirmNewPassword');
      const submitBtn = changePasswordForm.querySelector('button[type="submit"]');

      function validatePasswords() {
        const newPassword = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (newPassword && confirmPassword) {
          if (newPassword !== confirmPassword) {
            confirmPasswordInput.setCustomValidity('Passwords do not match');
            confirmPasswordInput.classList.add('is-invalid');
            submitBtn.disabled = true;
          } else {
            confirmPasswordInput.setCustomValidity('');
            confirmPasswordInput.classList.remove('is-invalid');
            confirmPasswordInput.classList.add('is-valid');
            submitBtn.disabled = false;
          }
        } else {
          confirmPasswordInput.classList.remove('is-invalid', 'is-valid');
          submitBtn.disabled = false;
        }
      }

      newPasswordInput.addEventListener('input', validatePasswords);
      confirmPasswordInput.addEventListener('input', validatePasswords);

      // File upload preview
      const profilePictureInput = document.getElementById('profilePicture');
      profilePictureInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            // Could add preview functionality here
            console.log('File selected:', file.name);
          };
          reader.readAsDataURL(file);
        }
      });

      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });

      // Add loading state to forms
      document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function() {
          const submitBtn = form.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
            submitBtn.disabled = true;
          }
        });
      });

      // Animate stat cards on scroll
      const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, observerOptions);

      document.querySelectorAll('.stat-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
      });

      // Achievement badges animation
      document.querySelectorAll('.achievement-badge').forEach((badge, index) => {
        badge.style.opacity = '0';
        badge.style.transform = 'scale(0.8)';
        badge.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        badge.style.transitionDelay = `${index * 0.1}s`;

        setTimeout(() => {
          badge.style.opacity = '1';
          badge.style.transform = 'scale(1)';
        }, 100);
      });
    });
  </script>
</body>
</html>